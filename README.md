<p align="center">
  <img src="demo.gif" alt="" />
</p>

# conmon

An alternative frontend for [conan C/C++ package manager](https://github.com/conan-io/conan) with build introspespection capabilities.

## features

* avoid screen clutter by minimizing emitted warnings by filtering and cropping paths, filter duplicate warnings

* monitoring build processes to detect which source files are compiled

* parsing emitted warnings and errors (compiler, cmake, ...) into machine-readable format

## details

* reducing warnings

## configuration

```yaml
[conmon]
conan_cmd = conan           # path to conan executable, leave empty for auto-detection
log.stderr = True           # if set to 'False' stderr stream will be ignored (no logging, no processing)
                            # if set to 'stdout' the stream will be redirected to stdout (analog to 2>&1)
log.level = debug           # default logging level [debug, info, warning, error, critical]
log.level.build = error     # specific logging level [.conmon, .build, .proc, .conan]
log.warning_count = False   # during build show number of warnings per translation unit
                            # works only if compiler warnings are sent to stdout
report.build.stdout = True  # enable/disable report.json logging of stdout stream for build process
report.build.stderr = True  # enable/disable report.json logging of stdout stream for build process
report.json = report.json   # path where the JSON report will be saved
tracelog = False            # enable and process conan tracelog file
                            # if the environment variable CONAN_TRACELOG_FILE is set
                            # the results will be added to report.json
proc.json = proc.json       # path where the JSON with the called compiler processes will be saved
conan.log = conan.log       # path where the raw conan output will be saved
conan.log.states = False    # if True, each stdout line of the conan log file will be prepended with the state name
build.monitor = 0.025       # the period in seconds in which new processes are detected
                            # if you don't need information about translation units you can set
                            # this to 'False' to save CPU time
```

## JSON report

#### The general structure of report.json
```json
{
  "conan": {"":  "information about the called conan command"},
  "profile": {"":  "the used 'host' and / or 'build' configuration (as specified by a profile)"},
  "requirements": {"":  "see below for details"},
  "stdout": ["stdout lines that do not refer to any requirement"],
  "stderr": ["stderr lines that do not refer to any requirement"]
}
```

#### The general structure of a requirement in report.json
```json
{
  "<requirement name>": {
    "version": "requirement version",
    "user": null,
    "channel": null,
    "remote": "'conan-center'",
    "package_id": "5a61a86bb3e07ce4262c80e1510f9c05e9b6d48b",
    "recipe_revision": "416618fa04d433c6bd94279ed2e93638",
    "stdout": ["stdout lines referring to this reference"],
    "stderr": ["stderr lines referring to this reference"],
    "export": ["stdout lines generated by the export step"],
    "build": {
      "stdout": ["stdout lines generated by build step"],
      "stderr": ["stderr lines generated by build step"],
      "translation_units": {"...":  "see below for details"},
      "warnings": ["parsed warnings generated by build step"]
    },
    "package": {
      "stdout": ["stdout lines generated by the package step"],
      "stderr": ["stderr lines generated by the package step"],
      "created_revision": "c2395bb37e84fe3d496b678814964b20"
    },
    "test_build": {"...":  "build info for test binaries (see build)"},
    "test_run": {
      "stdout": ["stdout lines of the test run"],
      "stderr": ["stderr lines of the test run"]
    },
    "actions": [
      "requirement actions from conan tracelog e.g.",
      "GOT_RECIPE_FROM_LOCAL_CACHE",
      "PACKAGE_BUILT_FROM_SOURCES"
    ]
  }
}
```

#### The general structure of a translation unit in report.json
```json
{
  "zlib/1.2.11": [
    {
      "compiler": "/usr/bin/x86_64-linux-gnu-gcc-9",
      "flags": [
        "-O3",
        "-MD",
        "-Wpedantic",
        "-fPIC",
        "-m64"
      ],
      "defines": [
        "NDEBUG",
        "PIC"
      ],
      "includes": [
        "zlib/1.2.11/_/_/build/6af9cc7cb931c5ad942174fd7838eb655717c709/build_subfolder",
        "zlib/1.2.11/_/_/build/6af9cc7cb931c5ad942174fd7838eb655717c709/source_subfolder",
        "..."
      ],
      "system_includes": [],
      "forced_includes": [],
      "sources": [
        "zlib/1.2.11/_/_/build/6af9cc7cb931c5ad942174fd7838eb655717c709/source_subfolder/adler32.c",
        "zlib/1.2.11/_/_/build/6af9cc7cb931c5ad942174fd7838eb655717c709/source_subfolder/compress.c",
        "zlib/1.2.11/_/_/build/6af9cc7cb931c5ad942174fd7838eb655717c709/source_subfolder/crc32.c",
        "..."
      ]
    }
  ]
}
```